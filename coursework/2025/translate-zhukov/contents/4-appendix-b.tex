\appendixsection{Алгоритм Шнорра для факторизации целых чисел}

\subsection*{Метод решета Шнорра}

Рассмотрим общую задачу факторизации, в которой задано целое число $N$,
предполагается разложить его на два нетривиальных множителя $p<q$, так что $N =
p\times q$. Метод решета для факторизации начинается с определения пары гладких
отношений.

Пусть $p_i,\; i = 1,\dots,n$ — первые $n$ простых чисел вместе с $p_0$,
удовлетворяющими $-1 = p_0 < 1 < p_1 < \dots < p_n < p$. Множество $P =
\{p_i\}_{i=0,\dots,n}$ называется простым базисом. Число $p_0 = -1$ не является
простым, однако включается для учёта знака целого числа. Целое число называется
$p_n$‑гладким, если все его простые делители меньше $p_n$; число $p_n$ при этом
называют пределом гладкости. Пара целых чисел $(u_j,v_j)$ называется
$p_n$‑гладкой парой, если и $u_j$, и $v_j$ являются $p_n$‑гладкими. Более того,
пара целых чисел $(u_j,v_j)$ называется $p_n$‑гладкой парой отношений
(сокращённо sr‑пара), если:

\begin{equation}
  u_{j} \;=\; \prod_{i=1}^{n} p_{i}^{\,e_{i,j}},
  \qquad
  u_{j} - v_{j}N \;=\; \prod_{i=0}^{n} p_{i}^{\,e'_{i,j}},
\end{equation}

\noindent где $e_{i,j},\,e'_{i,j}\in{N}$, тогда имеем

\begin{equation}
  \frac{u_{j}-v_{j}N}{u_{j}}
  \;\equiv\;
  \prod_{i=0}^{n} p_{i}^{\,e'_{i,j}-e_{i,j}}
  \;\equiv\; 1 \pmod{N}.
\end{equation}

Следует отметить, что гладкая пара отличается от sr‑пары: sr‑пара должна не
только быть $p_n$‑гладкой, но и удовлетворять более строгим условиям в
уравнении Б.3. Пусть $S=\{(u_j,v_j)\}_{j=1,\dots,n+1}$ — набор из $n\!+\!1$
sr‑пар. Пусть существуют коэффициенты $ t_1,\dots,t_{n+1}\in\{0,1\}$, такие что:

\begin{equation}
  \sum_{j=1}^{n+1} t_{j}\bigl(e'_{i,j}-e_{i,j}\bigr)
  \;\equiv\; 0 \pmod{2},
  \qquad i = 0,1,\dots,n.
\end{equation}

\noindent Обозначим $X \;=\ \prod_{i=0}^{n}p_{i}^{\frac12 \sum_{j=1}^{n+1} t_{j}\bigl(e'_{i,j}-e_{i,j}\bigr)},$
тогда

\begin{equation}
  X^{2}-1 \;=\; (X+1)(X-1) \;\equiv\; 0 \pmod{N}.
\end{equation}

\noindent Если $X \not\equiv \pm1 \pmod{N}$, то нетривиальный фактор числа $N$
получается как $\gcd(X \pm 1,\, N)$.

Поскольку размерность системы линейных уравнений равна~$O(n)$ и она решается
за~$O(n^{3})$ операций, эту малую часть вычислений при факторизации~$N$ мы
опускаем. Следовательно, задача факторизации сводится к задаче поиска sr‑пары.
В дальнейшем эта задача будет преобразована в задачу ближайшего вектора на
решётке.

\subsection*{Построение решётки и целевого вектора}

sr‑пары будут получены из приближённого решения задачи CVP в алгоритме Шнорра.
Сначала опишем построение простой решётки $\Lambda(B_{n,c})$ и целевого вектора
$t\in \mathbb{R}^{\,n+1}$; здесь $c>0$ — настраиваемый параметр. Матрица решётки
$B_{n,c}=[b_{1},\dots,b_{n}]\in \mathbb{R}^{(n+1)\times n}$ задаётся

\begin{equation}
  B_{n,c} =
  \begin{pmatrix}
    f(1)      & 0        & \dots & 0        \\
    0         & f(2)     & \dots & 0        \\
    \vdots    & \vdots   & \ddots& \vdots   \\
    0         & 0        & \dots & f(n)     \\
    N^{c}\ln p_{1} & N^{c}\ln p_{2} & \dots & N^{c}\ln p_{n}
  \end{pmatrix},
  \qquad
  t =
  \begin{pmatrix}
    0 \\[2pt]
    \vdots \\[2pt]
    0 \\[2pt]
    N^{c}\ln N
  \end{pmatrix}.
\end{equation}

\noindent где функции $f(i)$ при $i=1,\dots,n$ — случайные перестановки
диагональных элементов $(\sqrt{\ln p_{1}},\sqrt{\ln p_{2}},\dots, \sqrt{\ln
p_{n}})$.

Точку решётки или вектор можно представить целочисленной комбинацией базиса
решетки: $b=\sum_{i=1}^{n} e_{i} b_{i}\in\Lambda(B_{n,c})$, причём $e_{i}\in
Z$. Далее будем полагать, что $(u,v)$ — $p_{n}$‑гладкая пара и $\gcd(u,v)=1$.
Тогда $u,v$ выражаются через произведение простых чисел из простого базиса:

\begin{equation}
  u \;=\; \prod_{e_{i}>0} p_{i}^{\,e_{i}},
  \qquad
  v \;=\; \prod_{e_{i}<0} p_{i}^{\,-e_{i}}.
\end{equation}

В таком представлении гладкой паре $(u,v)$ взаимно однозначно соответствует
вектор $b=(e_{1},\dots,e_{n})$ на решётке, пишем $b\sim(u,v)$. Таким образом,
вектор решётки кодирует гладкую пару.

Задача ближайшего вектора (CVP) формулируется как поиск вектора
$b_{0}\in\Lambda(B_{n,c})$, минимально удалённого от $t$:

\begin{equation}
    b_{0} \;=\; \arg\min_{\,b\in\Lambda}\;\lVert b - t\rVert.
\end{equation}

Согласно приведённому выше определению справедливо отношение:

\begin{equation}
  \lVert b - t\rVert^{2}
  \;\ge\;
  \ln(uv) \;+\; N^{2c}\,\bigl|\ln\tfrac{u}{vN}\bigr|^{2}.
\end{equation}

Уравнение выполняется тогда и только тогда, когда $e_{i}\in\{-1,0,1\}$, то есть
$u,v$ не содержат квадратных множителей. Константа $N^{2c}$ выступает «весом»,
управляемым параметром $c$. При $N^{2c}\gg\ln(uv)$ главной частью равенства
становится $N^{2c}\,|\ln\frac{u}{vN}|^{2}$. Следовательно, параметр $c$ (также
называемый параметром точности) влияет на величину $|\ln\frac{u}{vN}|^{2}$, а
значит и на $|u-vN|$. Из неравенства Б.10 видно: чем короче вектор расстояния
$b-t$, тем меньше $|u-vN|$ и тем выше вероятность того, что $(u,v)$ является
sr‑парой. Дополнительное обсуждение этой зависимости приведено в следующем
разделе материала.

\subsection*{Решение CVP}

Существует два хорошо изученных подхода к решению задачи ближайшего вектора
(CVP) или её аппроксимации. Первый основан на методе решета, впервые
предложенном Айтаем с соавторами в 2001 г. \cite{cite_36}. Второй базируется на
алгоритме Бабаи: сначала выполняют редукцию решётки (например, алгоритмом LLL),
чтобы получить относительно короткий базис, а затем применяют процедуру
уменьшения размера для получения приближённого решения CVP. Шнорр использовал
именно второй подход. Фактически для повышения эффективности алгоритма
привлекают более совершенные методы редукции, такие как BKZ \cite{cite_37},
HKZ, ENUM \cite{cite_37,cite_38,cite_39,cite_40} и др. Однако эти методы
слишком сложны и требуют специальных знаний, выходящих за рамки данной работы.
Поэтому далее (также и в основном тексте) под алгоритмом Бабаи мы будем
подразумевать реализацию с использованием LLL‑редукции, которая проста и
относительно легко понимается. При этом принцип квантового ускорения алгоритма
Бабаи остается общим для любого метода редукции решётки.
